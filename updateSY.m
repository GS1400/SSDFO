%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% updateSY %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

function [S,Y,H,nh,im] = updateSY(S,Y,H,nh,im,mem,s,y)
%
% updateSY updates the quasi-Newton matrix that approximates
% the inverse to the Hessian.
sTy = s'*y;
updateOk = (sTy > sqrt(eps)*max(eps,norm(s)*norm(y)));

if updateOk 
  if im<mem, im=im+1;else, im=1; end
  S(:,im) = s; Y(:,im)=y;
  H(im,:)=y'*S; H(:,im)=H(im,:)';
  nh=nh+1;

end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%